---
import SceneLayout from 'src/layouts/SceneLayout.astro';
---

<SceneLayout title={'Template'} />

<script>
  import * as THREE from 'three';
  import BaseScene, { BaseSceneState, isReady } from '@lib/sceneController';
  import basicVertexShader from './shaders/vertex.vs.glsl?raw';
  import basicFragmentShader from './shaders/fragment.fs.glsl?raw';

  /* -------------------------------- */
  /*          Setup & Globals         */
  /* -------------------------------- */
  const canvas = document.getElementById('app_view')! as HTMLCanvasElement;
  const { state, registerRenderCallback, unregisterRenderCallback } = BaseScene(
    { canvas },
  );
  const { scene, renderer, camera, uniforms } = state;

  /* ---------------------------------------------- */
  /*                       Scene                    */
  /* ---------------------------------------------- */
  function Scene() {
    const geometry = new THREE.SphereGeometry(0.25, 30, 30);
    const material = new THREE.ShaderMaterial({
      uniforms,
      vertexShader: basicVertexShader,
      fragmentShader: basicFragmentShader,
      wireframe: true,
    });

    const mesh = new THREE.Mesh(geometry, material);
    scene.add(mesh);

    function animationLoop(state: BaseSceneState) {
      mesh.position.y = Math.sin(state.time * 2) / 2;
    }

    registerRenderCallback(animationLoop);
    isReady.set(true);
  }

  Scene();
</script>
