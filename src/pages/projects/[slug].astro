---
import Redirect from '../../components/Redirect.astro';
import Layout from '../../layouts/Layout.astro';
import { getProjects } from '../projects.astro';

export interface ProjectProps {
  title: string;
  subtitle: string;
  description: string;
  picture: string;
  lastUpdated: string;
  featured: boolean;
  tags: string[];
  visibility?: 'visible' | 'hidden';
  live?: string;
  github?: string;
  sandbox?: string;
}

export async function getStaticPaths() {
  try {
    const { projects, demos } = await getProjects();
    return [
      demos.map((demo) => {
        let url = demo.url?.replace('/projects/', '') ?? '';
        url = url.substring(0, url.lastIndexOf('/'));
        return {
          params: {
            slug: url.toLowerCase(),
          },
          props: {
            project: demo,
            redirect: url,
          },
        };
      }),
    ];
  } catch (error) {
    return [];
  }
}

const { slug } = Astro.params;
const { project } = Astro.props;
const redirect = Astro.props.redirect;
const { Content, frontmatter, url } = project;
const { title } = frontmatter;
---

<!-- FIXME only works in dev? -->
<Fragment>
  {redirect ? <Redirect url={redirect} /> : <Layout title={title} />}
</Fragment>

<style>
  main {
    width: 100%;
    max-width: calc(var(--content-max-width) * 0.75);
    padding: 0rem var(--padding-x);
    margin: 0 auto;
  }
</style>
